<main id="instalacion" name="Instalaciones" repo="instalacionRepo">
    <list id="listInstalacion" name="Instalaciones" description="Listado instalaciones">
       <!--<datatable properties="nombre_instalacion, operador.razon_social, direccion_instalacion, codigo_postal_instalacion, provincia.name, municipio.name" />-->
        <datatable>
            <column id="column_nombre_instalacion" headerText="Instalación" filtering="true" ordering="true" value="${entity.nombre_instalacion}">
                <filter property="nombre_instalacion" matching="contains" valueExpression="${this.column_nombre_instalacion}"/>
                <order property="nombre_instalacion"/>
            </column>
            <column id="column_razon_social" headerText="Razón social" filtering="false" ordering="false" value="${entity.operador.razon_social}"/>
            <column id="column_direccion_instalacion" headerText="Dirección instalación" filtering="true" ordering="true" value="${entity.direccion_instalacion}">
                <filter property="direccion_instalacion" matching="contains" valueExpression="${this.column_direccion_instalacion}"/>
                <order property="direccion_instalacion"/>
            </column>
            <column id="column_codigo_postal_instalacion" headerText="C.P. instalación" filtering="true" ordering="true" value="${entity.codigo_postal_instalacion}">
                <filter property="codigo_postal_instalacion" matching="contains" valueExpression="${this.column_codigo_postal_instalacion}"/>
                <order property="codigo_postal_instalacion"/>
            </column>
            <column id="column_provincia" headerText="Provincia" filtering="false" ordering="false" value="${entity.provincia.name}"/>
            <column id="column_municipio" headerText="Municipio" filtering="false" ordering="false" value="${entity.municipio.name}"/>
        </datatable>
        <buttonbar type="fab"/>
    </list>
    <edit id="editInstalacion">
        <form id="formInstalacion">

            <p value=""/>
            <divisor color="#00766C" strokeWidth="8" />
            <p bold="true" value="OPERADOR: "/>
            <divisor color="#00766C" strokeWidth="8" />

            <table border="false">
                <row>
                    <table headerText=" Id, Nombre operador" weights="20, 80">
                        <row>
                            <input value="${entity.operador_id}" placeHolder="${not empty(params.operador_id)?params.operador_id:not empty(params.entityId)?params.entityId:null}" readonly="true" />
                            <textarea value="${entity.operador.razon_social}" placeHolder="${not empty(params.razon_social)?params.razon_social:null}" readonly="true" />
                        </row>
                    </table>
                </row>
            </table>

            <input label="Instalacion: " value="${entity.nombre_instalacion}" validator="required"/>

            <textarea label="Dirección: " value="${entity.direccion_instalacion}" validator="required"  />

            <text label="Código postal: " id="cp_instalacion" value="${entity.codigo_postal_instalacion}" />

            <autocomplete label="Provincia: " forceSelection="true" id="provincia_instalacion" repo="provRepo" value="${entity.prov_id_instalacion}">
                <options labelExpression="${entity.name}" labelFilteringProperty="name" valueProperty="id" />
            </autocomplete>

            <autocomplete label="Municipio: " forceSelection="true" id="provmuni_instalacion" repo="muniRepo" value="${entity.provmuni_id_instalacion}">
                <options labelExpression="${entity.name}" labelFilteringProperty="name" valueProperty="provmuni" />
                <repofilter>
                    <eq property="prov" value="${view.provincia_instalacion}" mandatory="true"/>
                    <contains property="name" value="${this.value}"/>
                </repofilter>
            </autocomplete>

            <p value=""/>
            <divisor color="#00766C" strokeWidth="8" />
            <p bold="true" value="EQUIPOS"/>
            <divisor color="#00766C" strokeWidth="8" />

            <!--<button label="Añadir equipo" route="equipoMedida-editEquiposMedida" readonly="${empty (entity.instalacion_id)}" readonlyMessage="No puede añadir un equipo de medida. Antes debe guardar la instalación">
                <param name="instalacion_id" value="${entity.instalacion_id}" />
                <param name="nombre_instalacion" value="${entity.nombre_instalacion}" />
                <param name="operador_id" value="${entity.operador.operador_id}" />
                <param name="razon_social" value="${entity.operador.razon_social}" />
                <param name="backRoute" value="instalacion-editInstalacion" />
            </button>-->

            <button label="Añadir equipo" readonly="${empty (entity.instalacion_id)}" readonlyMessage="No puede añadir un equipo de medida. Antes debe guardar la instalación">
                <action type="save" route="equipoMedida-editEquiposMedida">
                    <param name="instalacion_id" value="${entity.instalacion_id}" />
                    <param name="nombre_instalacion" value="${entity.nombre_instalacion}" />
                    <param name="operador_id" value="${entity.operador.operador_id}" />
                    <param name="razon_social" value="${entity.operador.razon_social}" />
                </action>
            </button>
            <datatable
                route="equipoMedida-editEquiposMedida"
                numVisibleRows="3"
                repo="equipoMedidaRepo">
                <column id="column_equipo" headerText="Equipo" filtering="true" ordering="true" value="${entity.equipo}">
                    <filter property="equipo" matching="contains" valueExpression="${this.column_equipo}"/>
                    <order property="equipo"/>
                </column>
                <column id="column_nombre_instalacion_equipo" headerText="Instalación" filtering="false" ordering="false" value="${entity.instalacion.nombre_instalacion}"/>
                <column id="column_marca_y_modelo" headerText="Marca y modelo" filtering="true" ordering="true" value="${entity.marca_y_modelo}">
                    <filter property="marca_y_modelo" matching="contains" valueExpression="${this.column_marca_y_modelo}"/>
                    <order property="marca_y_modelo"/>
                </column>
                <param name="instalacion_id" value="${entity.instalacion_id}" />
                <param name="nombre_instalacion" value="${entity.instalacion.nombre_instalacion}" />
                <param name="operador_id" value="${entity.instalacion.operador.operador_id}" />
                <param name="razon_social" value="${entity.instalacion.operador.razon_social}" />
                <param name="backRoute" value="instalacion-editInstalacion" />
                <repofilter>
                    <and>
                        <eq property="instalacion_id" value="${empty(entity.instalacion_id) ? '-1' : entity.instalacion_id}" />
                    </and>
                </repofilter>
            </datatable>
        </form>
        <!--<actions>
            <save label="Save" route="${not empty (params.backRoute)? params.backRoute : 'instalacion-listInstalacion'}" registerInHistory="false" restoreView="true">
                <param name="entityId" value="${params.operador_id}" />
            </save>
            <cancel label="Cancel" route="${not empty (params.backRoute)? params.backRoute : 'instalacion-listInstalacion'}" restoreView="true">
                <param name="entityId" value="${params.operador_id}" />
            </cancel>
            <delete label="Delete" route="${empty (entity.instalacion_id) ? null : (not empty (params.backRoute)? params.backRoute : 'instalacion-listInstalacion')}" registerInHistory="false" message="No puede realizar esta acción: No existe la instalacion" restoreView="true">
                <param name="entityId" value="${params.operador_id}" />
            </delete>
        </actions>-->

        <buttonbar type="bottom">
            <button label="Save">
                <action type="save" route="back" registerInHistory="false" restoreView="true">
                    <param name="entityId" value="${params.operador_id}" />
                </action>
            </button>

            <button label="Cancel">
                <action type="cancel" route="back" restoreView="true">
                    <param name="entityId" value="${params.operador_id}" />
                </action>
            </button>

            <button label="Delete" readonly="${empty (entity.instalacion_id)}" readonlyMessage="No puede realizar esta acción: No existe la instalación">
                <action type="delete" route="back" registerInHistory="false" restoreView="true">
                    <param name="entityId" value="${params.operador_id}" />
                </action>
            </button>
        </buttonbar>

    </edit>
</main>
