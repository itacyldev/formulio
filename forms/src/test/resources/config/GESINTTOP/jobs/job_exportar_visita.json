{
  "description": "Visita",
  "requiredContexts": [
    "user",
    "job"
  ],
  "globalParams": {
    "endpoint": "https://serviciosprex.itacyl.es/uqserv/cnt/rest/files/",
    "apikey": "USER-MUNGARRO-UQSERV",
    "jobType": "FormicExportarUnidadesMuestrales",
    "endpointActa": "https://serviciosprex.itacyl.es/uqserv/cnt/rest/jobs/"
  },
  "executionMode": "FG_ASYNC",
  "tasks": [
    {
      "name": "t1",
      "reader": {
        "type": "sqlreader",
        "dbFile": "data/gesinttop.sqlite",
        "sqlQuery": "SELECT visita.visita_id as 'ID. VISITA', visita.visita as 'VISITA', ifnull(fecha_evaluacion, '') AS 'FECHA EVALUACIÓN', ifnull(evaluador, '') as 'EVALUADOR', c_refrec as 'RECINTO', ifnull(habitat.d_habitat,'') as 'HABITAT', ifnull(grupoprod.d_grupoprod, '') as 'GRUPO PRODUCTO', ifnull(producto.d_producto, '') as 'PRODUCTO', ifnull(sistema_explotacion.d_sistema_explotacion, '') as 'SISTEMA EXPLOTACIÓN', ifnull(tipo_laboreo.d_tipo_laboreo, '') as 'TIPO LABOREO', ifnull(tipo_actuacion_parcela.d_tipo_actuacion_parcela, '') as 'TIPO ACTUACIÓN PARCELA', ifnull(estado_cubierta_parcela.d_estado_cubierta_parcela, '') as 'ESTADO CUBIERTA PARCELA', ifnull(densidad_cubierta_parcela.d_densidad_cubierta_parcela, '') as 'DENSIDAD CUBIERTA PARCELA', ifnull(altura_cubierta_parcela.d_altura_cubierta_parcela, '') as 'ALTURA CUBIERTA PARCELA', ifnull(presencia_lenosas_parcela.d_presencia_lenosas_parcela, '') as 'PRESENCIA LEÑOSAS PARCELA', ifnull(apreciacion_visual_rodales_topillo_parcela.d_apreciacion_visual_rodales_topillo_parcela, '') as 'APRECIACIÓN VISUAL RODALES TOPILLO PARCELA', ifnull(porcentaje_rodales_topillo_parcela.d_porcentaje_rodales_topillo_parcela, '') as 'PORCENTAJE SUPERFICIE RODALES TOPILLO PARCELA', ifnull(observaciones_parcela, '') as 'OBSERVACIONES PARCELA', ifnull(tipo_linde.d_tipo_linde, '') as 'TIPO LINDE', ifnull(d_altura_linde, '') as 'ALTURA LINDE', ifnull(d_anchura_linde, '') as 'ANCHURA LINDE', ifnull(tipo_actuacion_linde.d_tipo_actuacion_linde, '') as 'TIPO ACTUACIÓN LINDE', ifnull(estado_cubierta_linde.d_estado_cubierta_linde, '') as 'ESTADO CUBIERTA LINDE', ifnull(densidad_cubierta_linde.d_densidad_cubierta_linde, '') as 'DENSIDAD CUBIERTA LINDE', ifnull(altura_cubierta_linde.d_altura_cubierta_linde, '') as 'ALTURA CUBIERTA LINDE', ifnull(presencia_lenosas_linde.d_presencia_lenosas_linde, '') as 'PRESENCIA LEÑOSAS LINDE', ifnull(apreciacion_visual_rodales_topillo_linde.d_apreciacion_visual_rodales_topillo_linde, '') as 'APRECIACIÓN VISUAL RODALES TOPILLO LINDE', ifnull(porcentaje_rodales_topillo_linde.d_porcentaje_rodales_topillo_linde, '') as 'PORCENTAJE SUPERFICIE RODALES TOPILLO LINDE', ifnull(observaciones_linde, '') as 'OBSERVACIONES LINDE', ifnull(position, '') as 'POSICIÓN' FROM visita LEFT JOIN recinto ON recinto.c_recinto_id = visita.c_recinto_id LEFT JOIN habitat ON habitat.c_habitat_id = visita.c_habitat_id LEFT JOIN grupoprod ON grupoprod.c_grupoprod_id = visita.c_grupoprod_id LEFT JOIN producto ON producto.c_producto_id = visita.c_producto_id LEFT JOIN sistema_explotacion ON sistema_explotacion.c_sistema_explotacion_id = visita.c_sistema_explotacion_id LEFT JOIN tipo_laboreo ON tipo_laboreo.c_tipo_laboreo_id = visita.c_tipo_laboreo_id LEFT JOIN tipo_actuacion_parcela ON tipo_actuacion_parcela.c_tipo_actuacion_parcela_id = visita.c_tipo_actuacion_parcela_id LEFT JOIN estado_cubierta_parcela ON estado_cubierta_parcela.c_estado_cubierta_parcela_id = visita.c_estado_cubierta_parcela_id LEFT JOIN densidad_cubierta_parcela ON densidad_cubierta_parcela.c_densidad_cubierta_parcela_id = visita.c_densidad_cubierta_parcela_id LEFT JOIN altura_cubierta_parcela ON altura_cubierta_parcela.c_altura_cubierta_parcela_id = visita.c_altura_cubierta_parcela_id LEFT JOIN presencia_lenosas_parcela ON presencia_lenosas_parcela.c_presencia_lenosas_parcela_id = visita.c_presencia_lenosas_parcela_id LEFT JOIN apreciacion_visual_rodales_topillo_parcela ON apreciacion_visual_rodales_topillo_parcela.c_apreciacion_visual_rodales_topillo_parcela_id = visita.c_apreciacion_visual_rodales_topillo_parcela_id LEFT JOIN porcentaje_rodales_topillo_parcela ON porcentaje_rodales_topillo_parcela.c_porcentaje_rodales_topillo_parcela_id = visita.c_porcentaje_rodales_topillo_parcela_id LEFT JOIN tipo_linde ON tipo_linde.c_tipo_linde_id = visita.c_tipo_linde_id LEFT JOIN tipo_actuacion_linde ON tipo_actuacion_linde.c_tipo_actuacion_linde_id = visita.c_tipo_actuacion_linde_id LEFT JOIN estado_cubierta_linde ON estado_cubierta_linde.c_estado_cubierta_linde_id = visita.c_estado_cubierta_linde_id LEFT JOIN densidad_cubierta_linde ON densidad_cubierta_linde.c_densidad_cubierta_linde_id = visita.c_densidad_cubierta_linde_id LEFT JOIN altura_cubierta_linde ON altura_cubierta_linde.c_altura_cubierta_linde_id = visita.c_altura_cubierta_linde_id LEFT JOIN presencia_lenosas_linde ON presencia_lenosas_linde.c_presencia_lenosas_linde_id = visita.c_presencia_lenosas_linde_id LEFT JOIN apreciacion_visual_rodales_topillo_linde ON apreciacion_visual_rodales_topillo_linde.c_apreciacion_visual_rodales_topillo_linde_id = visita.c_apreciacion_visual_rodales_topillo_linde_id LEFT JOIN porcentaje_rodales_topillo_linde ON porcentaje_rodales_topillo_linde.c_porcentaje_rodales_topillo_linde_id = visita.c_porcentaje_rodales_topillo_linde_id WHERE visita.visita_id='${params.visita_id}'"
      },
      "writer": {
        "type": "excelWriter",
        "sheetName": "VISITA",
        "outputFile": "Visita_${params.visita}.xlsx"
      }
    }
  ]
}