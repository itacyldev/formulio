<main name="auditoria" description="Auditorias" id="idAuditoria" repo="auditoriaRepo">
    <list id="listAuditoria" name="Auditoria" description="Listado auditorias">
        <datatable properties="auditoria_id,fecha" route="idAuditoria-editAuditoria2"/>
        <buttonbar type="fab">
            <button id="createButton">
                <action id="createAuditoria" type="create" route="idAuditoria-editAuditoria2">
                    <param name="repo" value="auditoriaRepo"/>
                    <param name="fecha" value="${date.now}"/>
                </action>
            </button>
        </buttonbar>

    </list>
    <edit id="editAuditoria1">
        <form>
            <datatable repo="preguntaAuditoriaRepo" route="idAuditoria-editAuditoria2">
                <action type="nav" route="idAuditoria-editAuditoria2" registerInHistory="false">
                    <param name="entityId" value="${entity.auditoria_id}"/>
                </action>
                <repofilter>
                    <and>
                        <eq property="auditoria_id" value="${empty(entity.auditoria_id) ? '-1' : entity.auditoria_id}" />
                    </and>
                </repofilter>
            </datatable>
        </form>
    </edit>
    <edit id="editAuditoria2" repo="preguntaAuditoriaRepo">
        <!--
        <script src="scripts/auditoria.js">
        </script>
        -->
        <form>

           <input label="Id. auditoria: " id="newAuditoria" readonly="true" placeHolder="${params.entityId}" value="${entity.auditoria_id}" />
            <!--<datatable repo="preguntaAuditoriaRepo" properties="pregunta.texto_pregunta, respuesta, observaciones">
                <repofilter>
                    <eq property="auditoria_id" value="${view.newAuditoria}"/>
                </repofilter>
            </datatable>-->

            <!--<radio id="pruebaRespuesta" value="" orientation="horizontal" action="showObservaciones" hasDeleteButton="false" refresh="pruebaObservaciones">
                <options>
                    <option id="optionPruebaOK" label="ok" value="ok" />
                    <option id="optionPruebaObs" label="obs" value="obs" />
                    <option id="optionPruebaNC" label="nc" value="nc" />
                </options>
            </radio>
            <textarea id="pruebaObservaciones" label="Observaciones prueba" value="" render="${view.pruebaRespuesta eq 'obs'}"/>-->
            <tab>
                <tabitem label="Datos de registro">
                    <autocomplete converter="integer" forceSelection="true" label="1. Bodega" repo="bodegaRepo" value="${entity.auditoria.bodega_id}">
                        <options labelExpression="${entity.razon_social}" labelFilteringProperty="razon_social" valueProperty="bodega_id" />
                    </autocomplete>
                    <date label="2. Fecha" value="${entity.auditoria.fecha}"/>
                    <input label="3. Alcance" value="${entity.auditoria.alcance}"/>
                    <select label="4. Tipo" value="${entity.auditoria.tipo}">
                        <options>
                            <option label="Tipo 1" value="T1"/>
                            <option label="Tipo 2" value="T2"/>
                            <option label="Tipo 3" value="T3"/>
                        </options>
                    </select>
                    <input label="5. Num. visita" value="${entity.auditoria.num_visita}" inputType="4"/>
                    <textarea label="6. Interlocutores" value="${entity.auditoria.interlocutores}"/>
                    <textarea label="7. Auditores" value="${entity.auditoria.auditores}"/>

                </tabitem>

                <tabitem label="Datos complementarios">

                    <p value=""/>
                    <divisor color="#00766C" strokeWidth="8" />
                    <p bold="true" value="DATOS GENERALES DE BODEGA AUDITADA "/>
                    <divisor color="#00766C" strokeWidth="8" />
                    <p value=""/>

                    <table weights="40, 60" headerText=" 1.1 ¿Coinciden los Registros del C.R. con el alcance solicitado?">
                        <row colspans="2">
                            <p value="Comprobar inscripción en los Registros del C.R."/>
                        </row>
                        <row>
                            <textarea readonly="true" value="Fecha 1: "/>
                            <date converter="string" value="${entity.auditoria.q1_1_fecha1}" hasDeleteButton="false" hasTodayButton="false" />
                        </row>

                        <row>
                            <textarea readonly="true" value="Fecha 2: "/>
                            <date converter="string" value="${entity.auditoria.q1_1_fecha2}" hasDeleteButton="false" hasTodayButton="false"/>
                        </row>

                        <row>
                            <textarea readonly="true" value="Fecha 3: "/>
                            <date converter="string" value="${entity.auditoria.q1_1_fecha3}" hasDeleteButton="false" hasTodayButton="false"/>
                        </row>

                        <row>
                            <textarea readonly="true" value="Fecha 4: "/>
                            <date converter="string" value="${entity.auditoria.q1_1_fecha4}" hasDeleteButton="false" hasTodayButton="false"/>
                        </row>
                    </table>

                    <p value=""/>

                    <table weights="40, 60" headerText=" 1.2. ¿Posee en vigor el Registro General Sanitario de Empresas Alimentarias para la instalación auditada?">
                        <row colspans="2">
                            <p value="Comprobar inscripción en el RGSEAA (puede hacerse vía AESAN o IREA) o solicitud de inscripción junto con declaración responsable del solicitante. Comprobar último acta de inspección emitido por la Administración." />
                        </row>
                        <row>
                            <textarea readonly="true" value="Nº RGSEAA:" />
                            <textarea value="${entity.auditoria.q1_2_num_rgseaa}" hasDeleteButton="false" inputType="4" />
                        </row>
                        <row>
                            <textarea readonly="true" value="Fecha:" />
                            <date converter="string" value="${entity.auditoria.q1_2_fecha}" hasDeleteButton="false" hasTodayButton="false"/>
                        </row>
                        <row>
                            <textarea readonly="true" value="Nº Acta:" />
                            <textarea value="${entity.auditoria.q1_2_num_acta}" hasDeleteButton="false" />
                        </row>
                        <row>
                            <textarea readonly="true" value="F. últ. insp. san.:" />
                            <date converter="string" value="${entity.auditoria.q1_2_fecha_ultima_inspeccion_sanitaria}" hasDeleteButton="false" hasTodayButton="false"/>
                        </row>
                    </table>

                    <textarea label="Datos complementarios a la auditoria." hint="Actividad/es en desarrollo en la bodega durante la auditoría." value="${entity.auditoria.q1_complementarios}"/>

                    <p value=""/>
                    <divisor color="#00766C" strokeWidth="8" />
                    <p bold="true" value="ELABORACIÓN "/>
                    <divisor color="#00766C" strokeWidth="8" />
                    <p value=""/>

                    <table headerText=" 3.2. ¿Disponen de las Declaraciones de Producción?" weights="32, 37, 31">
                        <row colspans="3">
                            <p value="Comprobar Declaración de Producción de vino del CRDOP. Comprobar coincidencia con Declaración de Producción de la Administración y asiento en libros-registro. Comprobar Rendimiento extracción para vino amparado  ≤ 70 (ó 72) litros de vino / 100 kg de uva."/>
                        </row>
                        <row>
                            <textarea readonly="true" value="Cosecha"/>
                            <textarea readonly="true" value="Vino DPO"/>
                            <textarea readonly="true" value="TOTAL"/>
                        </row>
                        <row>
                            <textarea readonly="true" value="Tinto"/>
                            <textarea value="${entity.auditoria.q3_2_dpo_tinto}" hasDeleteButton="false" inputType="4"/>
                            <textarea value="${entity.auditoria.q3_2_total_tinto}" hasDeleteButton="false" inputType="4"/>
                        </row>
                        <row>
                            <textarea readonly="true" value="Rosado"/>
                            <textarea value="${entity.auditoria.q3_2_dpo_rosado}" hasDeleteButton="false" inputType="4"/>
                            <textarea value="${entity.auditoria.q3_2_total_rosado}" hasDeleteButton="false" inputType="4"/>
                        </row>
                        <row>
                            <textarea readonly="true" value="Blanco"/>
                            <textarea value="${entity.auditoria.q3_2_dpo_blanco}" hasDeleteButton="false" inputType="4"/>
                            <textarea value="${entity.auditoria.q3_2_total_blanco}" hasDeleteButton="false" inputType="4"/>
                        </row>
                        <row>
                            <textarea readonly="true" value="Otros"/>
                            <textarea value="${entity.auditoria.q3_2_dop_otros}" hasDeleteButton="false" inputType="4"/>
                            <textarea value="${entity.auditoria.q3_2_total_otros}" hasDeleteButton="false" inputType="4"/>
                        </row>
                        <row colspans="3">
                            <textarea label="Rend. DOP:" value="${entity.auditoria.q3_2_rend_dpo}" hasDeleteButton="false"/>
                        </row>
                        <row colspans="3">
                            <textarea label="Rend. TOTAL:" value="${entity.auditoria.q3_2_rend_total}" hasDeleteButton="false"/>
                        </row>
                    </table>

                    <textarea label="Datos complementarios a la auditoria." hint="Tipos y Clases de vino elaborados y su coincidencia con lo indicado en Solicitud de certificación." value="${entity.auditoria.q3_complementarios}"/>

                    <p value=""/>
                    <divisor color="#00766C" strokeWidth="8" />
                    <p bold="true" value="EMBOTELLADO Y ETIQUETADO "/>
                    <divisor color="#00766C" strokeWidth="8" />
                    <p value=""/>

                    <table weights="40, 60" headerText=" 6.1¿Poseen el Registro Embotellador para la instalación y está inscrita como tal en los Registros del CRDO?">
                        <row colspans="2">
                            <p value="Comprobar inscripción en el Registro de Envasadores y Embotelladores de Vino y Bebidas Alcohólicas. Se comprobará igualmente su inscripción como instalación embotelladora en los Registros del CRDO." />
                        </row>
                        <row>
                            <textarea readonly="true" value="Nº RE:" />
                            <textarea value="${entity.auditoria.q6_1_num_re}" hasDeleteButton="false" inputType="4"/>
                        </row>
                        <row>
                            <textarea readonly="true" value="Fecha:" />
                            <date converter="string" value="${entity.auditoria.q6_1_fecha}" hasDeleteButton="false" hasTodayButton="false"/>
                        </row>
                    </table>

                    <textarea label="Datos complementarios a la auditoria." hint="Métodos y equipos utilizados en laboratorio para realizar análisis físico-químicos." value="${entity.auditoria.q6_complementarios}"/>

                </tabitem>

                <tabitem label="Datos generales bodega" id="datosGeneralesBodega">
                     <button id="botonDatosGeneralesBodega" label="GUARDAR">
                        <action type="save" controller="datalistDatosGeneralesBodega"/>
                    </button>

                    <datalist id="datalistDatosGeneralesBodega" repo="preguntaAuditoriaRepo">
                        <repofilter>
                            <and>
                                <eq property="auditoria_id" value="${params.entityId}"/>
                                <eq property="tab_id" value="datosGeneralesBodega"/>
                            </and>
                        </repofilter>
                        <datalistitem>
                            <p bold="true" value="${entity.pregunta.texto_pregunta}"/>
                            <radio id="respuestaDatosGeneralesBodega" value="${entity.respuesta}" orientation="horizontal"  hasDeleteButton="false" hint="${entity.pregunta.desc_observaciones}" validator="required">
                                <options>
                                    <option id="optionDatosGeneralesBodegaOK" label="ok" value="ok" />
                                    <option id="optionDatosGeneralesBodegaObs" label="obs" value="obs" />
                                    <option id="optionDatosGeneralesBodegaNC" label="nc" value="nc" />
                                </options>
                            </radio>
                            <textarea label="Observaciones" value="${entity.observaciones}" render="${view.respuestaDatosGeneralesBodega eq 'obs'}"  validator="required"/>
                        </datalistitem>
                    </datalist>
                </tabitem>

                <tabitem label="Entrada de uva" id="entradaDeUva">
                    <button id="botonEntradaDeUva" label="GUARDAR">
                        <action type="save" controller="datalistEntradaDeUva"/>
                    </button>

                    <datalist id="datalistEntradaDeUva" repo="preguntaAuditoriaRepo">
                        <repofilter>
                            <and>
                                <eq property="auditoria_id" value="${params.entityId}"/>
                                <eq property="tab_id" value="entradaDeUva"/>
                            </and>
                        </repofilter>
                        <datalistitem>
                            <p bold="true" value="${entity.pregunta.texto_pregunta}"/>
                            <radio id="respuestaEntradaDeUva" value="${entity.respuesta}" orientation="horizontal"  hasDeleteButton="false" hint="${entity.pregunta.desc_observaciones}">
                                <options>
                                    <option id="optionEntradaDeUvaOK" label="ok" value="ok" />
                                    <option id="optionEntradaDeUvaObs" label="obs" value="obs" />
                                    <option id="optionEntradaDeUvaNC" label="nc" value="nc" />
                                </options>
                            </radio>
                            <textarea label="Observaciones" value="${entity.observaciones}" render="${view.respuestaEntradaDeUva eq 'obs'}"/>
                        </datalistitem>
                    </datalist>
                </tabitem>

                <tabitem label="Elaboración" id="elaboracion">
                    <button id="botonElaboracion" label="GUARDAR">
                        <action type="save" controller="datalistElaboracion"/>
                    </button>

                    <datalist id="datalistElaboracion" repo="preguntaAuditoriaRepo">
                        <repofilter>
                            <and>
                                <eq property="auditoria_id" value="${params.entityId}"/>
                                <eq property="tab_id" value="elaboracion"/>
                            </and>
                        </repofilter>
                        <datalistitem>
                            <p bold="true" value="${entity.pregunta.texto_pregunta}"/>
                            <radio id="respuestaElaboracion" value="${entity.respuesta}" orientation="horizontal"  hasDeleteButton="false" hint="${entity.pregunta.desc_observaciones}">
                                <options>
                                    <option id="optionElaboracionOK" label="ok" value="ok" />
                                    <option id="optionElaboracionObs" label="obs" value="obs" />
                                    <option id="optionElaboracionNC" label="nc" value="nc" />
                                </options>
                            </radio>
                            <textarea label="Observaciones" value="${entity.observaciones}" render="${view.respuestaElaboracion eq 'obs'}"/>
                        </datalistitem>
                    </datalist>
                </tabitem>

                <tabitem label="Almacenamiento" id="almacenamiento">
                    <button id="botonAlmacenamiento" label="GUARDAR">
                        <action type="save" controller="datalistAlmacenamiento"/>
                    </button>

                    <datalist id="datalistAlmacenamiento" repo="preguntaAuditoriaRepo">
                        <repofilter>
                            <and>
                                <eq property="auditoria_id" value="${params.entityId}"/>
                                <eq property="tab_id" value="almacenamiento"/>
                            </and>
                        </repofilter>
                        <datalistitem>
                            <p bold="true" value="${entity.pregunta.texto_pregunta}"/>
                            <radio id="respuestaAlmacenamiento" value="${entity.respuesta}" orientation="horizontal"  hasDeleteButton="false" hint="${entity.pregunta.desc_observaciones}">
                                <options>
                                    <option id="optionAlmacenamientoOK" label="ok" value="ok" />
                                    <option id="optionAlmacenamientoObs" label="obs" value="obs" />
                                    <option id="optionAlmacenamientoNC" label="nc" value="nc" />
                                </options>
                            </radio>
                            <textarea label="Observaciones" value="${entity.observaciones}" render="${view.respuestaAlmacenamiento eq 'obs'}"/>
                        </datalistitem>
                    </datalist>
                </tabitem>

                <tabitem label="Crianza" id="crianza">
                    <button id="botonCrianza" label="GUARDAR">
                        <action type="save" controller="datalistCrianza"/>
                    </button>
                    <datalist id="datalistCrianza" repo="preguntaAuditoriaRepo">
                        <repofilter>
                            <and>
                                <eq property="auditoria_id" value="${params.entityId}"/>
                                <eq property="tab_id" value="crianza"/>
                            </and>
                        </repofilter>
                        <datalistitem>
                            <p bold="true" value="${entity.pregunta.texto_pregunta}"/>
                            <radio id="respuestaCrianza" value="${entity.respuesta}" orientation="horizontal"  hasDeleteButton="false" hint="${entity.pregunta.desc_observaciones}">
                                <options>
                                    <option id="optionCrianzaOK" label="ok" value="ok" />
                                    <option id="optionCrianzaObs" label="obs" value="obs" />
                                    <option id="optionCrianzaNC" label="nc" value="nc" />
                                </options>
                            </radio>
                            <textarea label="Observaciones" value="${entity.observaciones}" render="${view.respuestaCrianza eq 'obs'}" />
                        </datalistitem>
                    </datalist>
                </tabitem>

                <tabitem label="Embotellado y Etiquetado" id="embotelladoEtiquetado">
                    <button id="botonEmbotelladoEtiquetado" label="GUARDAR">
                        <action type="save" controller="datalistEmbotelladoEtiquetado"/>
                    </button>
                    <datalist id="datalistEmbotelladoEtiquetado" repo="preguntaAuditoriaRepo">
                        <repofilter>
                            <and>
                                <eq property="auditoria_id" value="${params.entityId}"/>
                                <eq property="tab_id" value="embotelladoEtiquetado"/>
                            </and>
                        </repofilter>
                        <datalistitem>
                            <p bold="true" value="${entity.pregunta.texto_pregunta}"/>
                            <radio id="respuestaEmbotelladoEtiquetado" value="${entity.respuesta}" orientation="horizontal"  hasDeleteButton="false" hint="${entity.pregunta.desc_observaciones}">
                                <options>
                                    <option id="optionEmbotelladoEtiquetadoOK" label="ok" value="ok" />
                                    <option id="optionEmbotelladoEtiquetadoObs" label="obs" value="obs" />
                                    <option id="optionEmbotelladoEtiquetadoNC" label="nc" value="nc" />
                                </options>
                            </radio>
                            <textarea label="Observaciones" value="${entity.observaciones}" render="${view.respuestaEmbotelladoEtiquetado eq 'obs'}"/>
                        </datalistitem>
                    </datalist>
                </tabitem>
            </tab>


        </form>

        <buttonbar type="bottom">
            <button label="Save">
                <action route="idAuditoria-listAuditoria" type="save" registerInHistory="false" controller="form2, datalistDatosGeneralesBodega, datalistEntradaDeUva, datalistElaboracion, datalistAlmacenamiento, datalistCrianza, datalistEmbotelladoEtiquetado"/>
            </button>
            <button label="Cancel" route="back"/>
        </buttonbar>

        <!--<actions>
            <save label="Save" route="idAuditoria-listAuditoria" registerInHistory="false"/>
            <cancel label="Cancel" route="idAuditoria-listAuditoria"/>
        </actions>-->
    </edit>
</main>
