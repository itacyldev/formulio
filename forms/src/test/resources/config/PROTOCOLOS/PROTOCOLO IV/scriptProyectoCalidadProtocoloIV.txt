CREATE TABLE "grupo_producto" (
	"grupo_producto_id" TEXT PRIMARY KEY,
	"nombre_grupo_producto"	TEXT
)

insert into "grupo_producto"
(
	grupo_producto_id, 
	nombre_grupo_producto
)
values
	("1", "ACEITES Y GRASAS"),
	("2", "CERVEZAS"),
	("3", "CARNES Y DERIVADOS CÁRNICOS"),
	("4", "CONDIMENTOS Y ESPECIAS"),
	("5", "HUEVOS Y OVOPRODUCTOS"),
	("6", "LECHE Y DERIVADOS LÁCTEOS"),
	("7", "PRODUCTOS DE LA APICULTURA"),
	("8", "PRODUCTOS DE PANADERÍA, PASTELERÍA Y REPOSTERÍA"),
	("9", "PRODUCTOS DE LA ACUICULTURA Y ALGAS"),
	("10", "PRODUCTOS DE ORIGEN VEGETAL SIN TRANSFORMAR Y TRANSFORMADOS"),
	("11", "SALES, AZÚCARES Y VINAGRES"),
	("12", "VINOS"),
	("13", "BEBIDAS ESPIRITUOSAS"),
	("14", "VINOS AROMATIZADOS"),
	("15", "ACEITES ESENCIALES"),
	("16", "LEVADURAS")


CREATE TABLE "auditoria" (
	"auditoria_id"	INTEGER PRIMARY KEY AUTOINCREMENT,
	"num_expediente"	INTEGER,
	"fecha"	TEXT,
	"grupo_producto_id" TEXT,
	"equipo_auditor" TEXT,
	"url_medio" TEXT,
	"responsable_medio" TEXT,
	"nif" TEXT,
	"domicilio_responsable" TEXT,
	"prov_id" INTEGER,
	"provmuni_id" TEXT,
	"telefono" TEXT,
	"email" TEXT,
	"denominacion_producto" TEXT,
	"nombre_comercial_producto" TEXT,
	"marca" TEXT,
	"firma" TEXT,
	FOREIGN KEY(grupo_producto_id) REFERENCES grupo_producto(grupo_producto_id),
	FOREIGN KEY(prov_id) REFERENCES provincia(id),
	FOREIGN KEY(provmuni_id) REFERENCES municipio(provmuni))

CREATE TABLE "pregunta_auditoria" (
	"pregunta_auditoria_id"	INTEGER PRIMARY KEY AUTOINCREMENT,
	"auditoria_id" INTEGER,
	"pregunta_id" INTEGER,
	"tab_id" TEXT,
	"respuesta" TEXT,
	"observaciones" TEXT,
	"image_thumb" TEXT,
	FOREIGN KEY(auditoria_id) REFERENCES auditoria(auditoria_id),
	FOREIGN KEY(pregunta_id) REFERENCES pregunta(pregunta_id)
)

CREATE TRIGGER pregunta_auditoria AFTER INSERT ON auditoria
BEGIN
	INSERT INTO pregunta_auditoria (
		auditoria_id,
		pregunta_id,
		tab_id
	)
	SELECT
	  auditoria.auditoria_id,
	  pregunta.pregunta_id,
	  pregunta.tab_id
	FROM auditoria
	JOIN pregunta
	WHERE 
		auditoria.auditoria_id = (SELECT MAX(auditoria_id) FROM auditoria) and 
		(SELECT MAX(auditoria_id) FROM auditoria) not in (select distinct auditoria_id from pregunta_auditoria);
END;


CREATE TABLE 'pregunta'(
pregunta_id INTEGER PRIMARY KEY AUTOINCREMENT,
tab_id TEXT,
texto_pregunta TEXT,
desc_pregunta TEXT)

insert into pregunta (tab_id, texto_pregunta, desc_pregunta)
values
("indicacionObligatoriaProduccionEcologica", "1.1. Si el alimento está envasado y lleva términos referidos a producción ecológica, figura en el envase el logotipo de producción ecológica de la Unión Europea","Art. 24.1.b Reglamento (CE) 834/2007<br><br><div style='text-align: center'><img src='logo.png'/></div><br>El uso del Logotipo de producción ecológica de la Unión Europea es facultativo en el caso de los productos importados de terceros países y no se puede utilizar en productos en conversión ni alimentos transformados si menos del 95% de los ingredientes agrarios del producto en peso son ecológicos."),
("indicacionObligatoriaProduccionEcologica", "1.2. Si el alimento lleva los términos referidos a producción ecológica, figura en el etiquetado el código numérico de la autoridad de control u organismo de control de que dependa el operador responsable de la última operación de producción o preparación","Art. 24.1.a Reglamento (CE) 834/2007"),
("indicacionObligatoriaProduccionEcologica", "1.3. Si el alimento lleva el logotipo de producción ecológica, figura, la indicación del lugar de obtención de las materias primas agrarias de que se compone el producto* ** ***: 'Agricultura UE', 'Agricultura no UE', 'Agricultura UE/no UE' y esta figura en el mismo campo visual que el logotipo de producción ecológica de la Unión Europea","Art. 24.1.c Reglamento (CE) 834/2007. <br><br> *El término 'agricultura' puede ser sustituido por 'acuicultura' cuando proceda. <br><br> **La mención 'UE' o 'no UE' puede sustituirse por el nombre de un país o país y región, o completarse con dicho nombre en el caso de que todas las materias primas agrarias de que se compone el producto hayan sido obtenidas en ese país y, en su caso, en esa región. <br><br> ***Podrán no tenerse en cuenta las pequeñas cantidades en peso de ingredientes, siempre y cuando la cantidad total de los ingredientes que no se tengan en cuenta no supere el 2% de la cantidad total en peso de materias primas de origen agrario."),
("indicacionObligatoriaProduccionEcologica", "1.4. Si el alimento lleva los términos referidos a producción ecológica, en la lista de ingredientes de los alimentos transformados se indica cuáles son los ingredientes ecológicos","Art. 23.4 Reglamento (CE) 834/2007"),
("indicacionObligatoriaProduccionEcologica", "1.5. Si el alimento lleva los términos referidos a producción ecológica, en la lista de ingredientes de los alimentos transformados se indica el porcentaje total de ingredientes ecológicos en relación con la cantidad total de ingredientes agrarios","Art. 23.4 Reglamento (CE) 834/2007"),

("presentacionObligatoriaProduccionEcologica", "2.1. El color o estilo tipográfico de las indicaciones 'UE' y 'no UE' no destaca sobre el nombre del producto","Art. 24.1.c Reglamento (CE) 834/2007"),
("presentacionObligatoriaProduccionEcologica", "2.2. Las indicaciones figuran en un lugar destacado y son fácilmente visibles y claramente legibles","Art. 24.2 Reglamento (CE) 834/2007"),

("utilizacionTerminosProduccionEcologica", "3.1. Los términos referidos a la producción ecológica que figuran en el etiquetado, publicidad o documentos comerciales, se emplean únicamente para productos ecológicos (incluyendo marcas registradas o nombres de empresa)","Art. 23.1 y 2 del Reglamento (CE) 834/2007"),
("utilizacionTerminosProduccionEcologica", "3.2. En los alimentos transformados, si menos del 95% de los ingredientes agrarios del producto en peso son ecológicos, se cumple con la obligación de que los términos referidos a la producción ecológica se emplean únicamente en la lista de ingredientes","Art. 23.4 Reglamento (CE) 834/2007"),
("utilizacionTerminosProduccionEcologica", "3.3. En los alimentos transformados, si el ingrediente principal es un producto de la caza o pesca, los términos referidos a la producción ecológica están en la lista de ingredientes y en el mismo campo visual (pantalla) que la denominación de venta y claramente relacionados con otro ingrediente de origen agrario que sea ecológico en su totalidad","Art. 23.4 Reglamento (CE) 834/2007. <br><br> Los productos de la caza y de la pesca de animales salvajes no se considerarán productos ecológicos (Art. 1.2 del Reglamento (CE) 834/2007)"),

("certificadoProduccionEcologica", "4.1. Si el operador minorista, además de la venta directa al consumidor final de productos ecológicos envasados, produce, prepara, almacena, salvo en relación con el punto de venta, importa dichos productos de terceros países o subcontrata a otro operador para efectuar tales actividades, dispone del certificado emitido por las autoridades de control u organismos de control","Art. 24.2 del Reglamento (CE) 834/2007")


