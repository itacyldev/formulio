<main id="granelBarrica" name="Granel Barrica" repo="granelBarricaRepo" mainForm="false">
    <list id="listGranelBarrica" name="Granel Barrica" description="Listado graneles barrica">
       <datatable>
           <column headerText="Partida" filtering="false" ordering="false" value="${entity.partidaAforo.partida}"/>
           <column headerText="Añada" filtering="false" ordering="false" value="${entity.partidaAforo.anada}"/>
           <column id="column_numero_barricas_granel_barrica" headerText="Nº barricas" filtering="true" ordering="true" value="${entity.numero_barricas}">
               <filter property="numero_barricas" matching="contains" valueExpression="${this.column_numero_barricas_granel_barrica}"/>
               <order property="numero_barricas"/>
           </column>
           <column id="column_capacidad_granel_barrica" headerText="Capacidad" filtering="true" ordering="true" value="${entity.capacidad}">
               <filter property="capacidad" matching="contains" valueExpression="${this.column_capacidad_granel_barrica}"/>
               <order property="capacidad"/>
           </column>
           <column headerText="Volumen total" filtering="false" ordering="false" value="${math:round(entity.capacidad*entity.numero_barricas*math:pow(10,2))/math:pow(10,2)}"/>
           <column headerText="Tipo de vino" filtering="false" ordering="false" value="${entity.partidaAforo.vino.vino}"/>
           <column headerText="Nivel de protección" filtering="false" ordering="false" value="${entity.partidaAforo.nivelProteccion.nivel_proteccion}"/>
           <column id="column_observaciones_granel_barrica" headerText="Observaciones" filtering="true" ordering="true" value="${entity.observaciones}">
               <filter property="observaciones" matching="contains" valueExpression="${this.column_observaciones_granel_barrica}"/>
               <order property="observaciones"/>
           </column>
       </datatable>
        <buttonbar type="fab"/>
    </list>
    <edit id="editGranelBarrica">
        <form id="formGranelBarrica">

            <p value=""/>
            <p backgroundColor="#26a69a" fontSize="22" fontColor="#FFFFFF" bold="true" value="GRANEL BARRICA"/>

            <table headerText=" Id. Exp., Nº Exp., Id. DOP, DOP" weights="20, 30, 10, 40">
                <row>
                    <input id="expediente_id" value="${entity.partidaAforo.expediente_id}" placeHolder="${params.expediente_id}" readonly="true"/>
                    <input id="num_expediente" value="${entity.partidaAforo.expediente.num_expediente}" placeHolder="${params.num_expediente}" readonly="true"/>
                    <input id="dop_id" value="${entity.partidaAforo.expediente.dop_id}" placeHolder="${params.dop_id}" readonly="true"/>
                    <input id="dop" value="${entity.partidaAforo.expediente.dop.dop}" placeHolder="${params.dop}" readonly="true"/>
                </row>
            </table>
            <table headerText=" Id. Operador, Razón social" weights="20, 80">
                <row>
                    <input id="operador_id" value="${entity.partidaAforo.expediente.operador_id}" placeHolder="${params.operador_id}" readonly="true"/>
                    <input id="razon_social" value="${entity.partidaAforo.expediente.operador.razon_social}" placeHolder="${params.razon_social}" readonly="true"/>
                </row>
            </table>

            <table headerText=" Id. partida, Partida, Añada" weights="20, 50, 30">
                <row>
                    <input id="partida_aforo_id" value="${entity.partida_aforo_id}" placeHolder="${params.partida_aforo_id}" readonly="true"/>
                    <input id="partida" value="${entity.partidaAforo.partida}" placeHolder="${params.partida}" readonly="true"/>
                    <input id="anada" value="${entity.partidaAforo.anada}" placeHolder="${params.anada}" readonly="true"/>
                </row>
            </table>

            <table headerText=" Id. Nivel, Nivel de protección, Id Tipo, Tipo de vino" weights="20, 30, 20, 30">
                <row>
                    <input id="nivel_proteccion_id" value="${entity.partidaAforo.nivel_proteccion_id}" placeHolder="${params.nivel_proteccion_id}" readonly="true"/>
                    <input id="nivel_proteccion" value="${entity.partidaAforo.nivelProteccion.nivel_proteccion}" onBeforeRender="updateNivelProteccion" readonly="true"/>
                    <input id="vino_id" value="${entity.partidaAforo.vino_id}" placeHolder="${params.vino_id}" readonly="true"/>
                    <input id="vino" value="${entity.partidaAforo.vino.vino}"  onBeforeRender="updateTipoVino" readonly="true"/>
                </row>
            </table>

            <p value=""/>
            <divisor color="#00766C" strokeWidth="8" />
            <p bold="true" value="Granel-barrica"/>
            <divisor color="#00766C" strokeWidth="8" />

            <table border="false">
                <row>
                    <input label="Id.: " id="granel_barrica_id" value="${entity.granel_barrica_id}" readonly="true"/>
                    <autocomplete label="Barrica: " forceSelection="true" id="barrica_id" repo="barricaRepo" value="${entity.barrica_id}" validator="required">
                        <options labelExpression="${entity.numeracion}" labelFilteringProperty="numeracion" valueProperty="barrica_id" />
                        <repofilter>
                            <eq property="operador_id" value="${view.operador_id}" mandatory="true"/>
                            <contains property="numeracion" value="${this.value}"/>
                        </repofilter>
                    </autocomplete>
                </row>
                <row>
                    <input label="Tipo roble: " value="${view.barrica_id}" onBeforeRender="updateTipoRoble" readonly="true"/>
                    <input label="Unidades: " value="${view.barrica_id}" onBeforeRender="updateUnidades" readonly="true"/>
                    <input label="Capacidad: " value="${view.barrica_id}" onBeforeRender="updateCapacidad" readonly="true"/>
                </row>
                <row>
                    <input id="numero_barricas" label="Nº barricas: " value="${entity.numero_barricas}" inputType="3"/>
                    <input id="capacidad" label="Capacidad: " value="${entity.capacidad}" inputType="3"/>
                    <input label="Volumen total: " value="${view.numero_barricas gt 0 and view.capacidad gt 0?math:round(view.capacidad*view.numero_barricas)*math:pow(10,2)/math:pow(10,2):null}" readonly="true"/>
                </row>
                <row>
                    <textarea label="Observaciones: " value="${entity.observaciones}" />
                </row>
                <row>
                    <table border="false" weights="10, 35, 10, 35, 10">
                        <row>
                            <p value=""/>
                            <button label="Detalle barrica">
                                <action type="save" route="barrica-editBarrica">
                                    <param name="entityId" value="${view.barrica_id}" />
                                    <param name="granel_barrica_id" value="${entity.granel_barrica_id}" />
                                    <param name="operador_id" value="${view.operador_id}" />
                                    <param name="razon_social" value="${view.razon_social}" />
                                </action>
                            </button>
                            <p value=""/>
                            <button label="Nueva barrica">
                                <action type="nav" route="barrica-editBarrica">
                                    <param name="operador_id" value="${view.operador_id}" />
                                    <param name="razon_social" value="${view.razon_social}" />
                                </action>
                            </button>
                            <p value=""/>
                        </row>
                    </table>
                </row>
            </table>

        </form>

        <buttonbar type="bottom">
            <button label="Save">
                <action type="save" route="back" registerInHistory="false" restoreView="true">
                    <param name="entityId" value="${params.expediente_id}" />
                </action>
            </button>

            <button label="Cancel">
                <action type="cancel" route="back" restoreView="true">
                    <param name="entityId" value="${params.expediente_id}" />
                </action>
            </button>

            <button label="Delete" readonly="${empty (entity.granel_deposito_id)}" readonlyMessage="No puede realizar esta acción: No existe granel depósito" restoreView="true">
                <action type="delete" route="back" registerInHistory="false">
                    <param name="entityId" value="${params.expediente_id}" />
                </action>
            </button>
        </buttonbar>
    </edit>
</main>
