<main id="tipoMorcillaExpedicion" name="Tipo de morcilla (Expedición)" repo="tipoMorcillaExpedicionRepo" mainForm="false">
    <list id="listTipoMorcillaExpedicion" name="Tipo de morcilla (Expedición)" description="Listado tipos de morcilla (Expedición)">
        <datatable>
            <column id="column_tipo_morcilla" headerText="Tipo morcilla" filtering="false" ordering="false" value="${entity.tipoMorcillaInstalacion.tipo_morcilla}"/>
            <column id="column_nombre_instalacion" headerText="Instalación" filtering="false" ordering="false" value="${entity.loteControlDocumental.expediente.instalacion.nombre_instalacion}"/>
            <column id="column_kg_expedidos" headerText="Kg expedidos" filtering="false" ordering="false" value="${entity.kg_expedidos gt 0? math:round(math:pow(10,2)*entity.kg_expedidos)/math:pow(10,2):null}"/>
            <column id="column_unidad_kg" headerText="Unidades teóricas/kg" filtering="false" ordering="false" value="${entity.tipoMorcillaInstalacion.peso_unitario_kg gt 0? math:round(math:pow(10,2)/entity.tipoMorcillaInstalacion.peso_unitario_kg)/math:pow(10,2):null}"/>
            <column id="column_unidades_teoricas_expedidas" headerText="Unidades teóricas expedidas" filtering="false" ordering="false" value="${entity.kg_expedidos gt 0? math:round(math:pow(10,2)*(entity.kg_expedidos*entity.tipoMorcillaInstalacion.unidad_kg))/math:pow(10,2):null}"/>

        </datatable>
        <buttonbar type="fab"/>
    </list>
    <edit id="editTipoMorcillaExpedicion">
        <script src="scripts/controlLote.js"/>
        <form id="formTipoMorcillaExpedicion">

            <p value=""/>
            <p backgroundColor="#26a69a" fontSize="22" fontColor="#FFFFFF" bold="true" value="TIPO MORCILLA EXPEDICIÓN"/>

            <p value=""/>
            <divisor color="#00766C" strokeWidth="8" />
            <p bold="true" value="EXPEDIENTE: "/>
            <divisor color="#00766C" strokeWidth="8" />

            <table border="false" render="${not empty(params.expediente_id) or not empty(entity.loteControlDocumental.expediente_id)}">
                <row>
                    <table headerText=" Id. Exp., Nº Expediente" weights="25, 75" >
                        <row>
                            <input value="${entity.loteControlDocumental.expediente_id}" placeHolder="${not empty(params.expediente_id)?params.expediente_id:null}" readonly="true"/>
                            <textarea value="${entity.loteControlDocumental.expediente.num_expediente}" placeHolder="${not empty(params.num_expediente)?params.num_expediente:null}" readonly="true" />
                        </row>
                    </table>
                </row>
            </table>

            <p value=""/>
            <divisor color="#00766C" strokeWidth="8" />
            <p bold="true" value="LOTE CONTROL DOCUMENTAL: "/>
            <divisor color="#00766C" strokeWidth="8" />

            <table border="false">
                <row>
                    <table headerText=" Id. Lote., Nº Lote" weights="25, 75" >
                        <row>
                            <input value="${entity.lote_control_documental_id}" placeHolder="${not empty(params.lote_control_documental_id)?params.lote_control_documental_id:null}" readonly="true"/>
                            <textarea value="${entity.loteControlDocumental.num_lote}" placeHolder="${not empty(params.num_lote_control_documental)?params.num_lote_control_documental:null}" readonly="true" />
                        </row>
                    </table>
                </row>
            </table>

            <p value=""/>
            <divisor color="#00766C" strokeWidth="8" />
            <p bold="true" value="INSTALACION: "/>
            <divisor color="#00766C" strokeWidth="8" />

            <table border="false">
                <row>
                    <table headerText=" Id. , Nombre instalación" weights="25, 75">
                        <row>
                            <input id="instalacion_id" value="${entity.tipoMorcillaInstalacion.instalacion_id}" placeHolder="${not empty(params.instalacion_id)?params.instalacion_id:null}" readonly="true"/>
                            <textarea value="${entity.tipoMorcillaInstalacion.instalacion.nombre_instalacion}" placeHolder="${not empty(params.nombre_instalacion)?params.nombre_instalacion:null}" readonly="true" />
                        </row>
                    </table>
                </row>
            </table>

            <p value=""/>
            <divisor color="#00766C" strokeWidth="8" />
            <p bold="true" value="OPERADOR: "/>
            <divisor color="#00766C" strokeWidth="8" />

            <table border="false">
                <row>
                    <table headerText=" Id. , Nombre operador" weights="25, 75">
                        <row>
                            <input id="operador_id" value="${entity.tipoMorcillaInstalacion.instalacion.operador_id}" placeHolder="${not empty(params.operador_id)?params.operador_id:null}" readonly="true"/>
                            <textarea value="${entity.tipoMorcillaInstalacion.instalacion.operador.razon_social}" placeHolder="${not empty(params.razon_social)?params.razon_social:null}" readonly="true" />
                        </row>
                    </table>
                </row>
            </table>

            <p value=""/>
            <divisor color="#00766C" strokeWidth="8" />
            <p bold="true" value="TIPO DE MORCILLA: "/>
            <divisor color="#00766C" strokeWidth="8" />

            <autocomplete id="tipo_morcilla_instalacion_id" label="Tipo morcilla instalación: " value="${entity.tipo_morcilla_instalacion_id}" forceSelection="true" repo="tipoMorcillaInstalacionRepo" validator="required">
                <options labelExpression="${entity.tipo_morcilla}" labelFilteringProperty="tipo_morcilla" valueProperty="tipo_morcilla_instalacion_id" />
                <repofilter>
                    <eq property="instalacion_id" value="${view.instalacion_id}" mandatory="true"/>
                    <contains property="tipo_morcilla" value="${this.value}"/>
                </repofilter>
            </autocomplete>

            <table border="false">
                <row>

                    <input label="Kg. expedidos" value="${entity.kg_expedidos}" inputType="3" validator="required" readonly="true" render="${empty(view.tipo_morcilla_instalacion_id)}"/>

                    <input id="kg_expedidos" label="Kg. expedidos" value="${entity.kg_expedidos}" inputType="3" validator="required" render="${not empty(view.tipo_morcilla_instalacion_id)}"/>

                    <input id="unidad_kg" label="Unidades teóricas por kg.: " value="${view.tipo_morcilla_instalacion_id}"  onBeforeRender="updateUnidadesTeoricasKG" readonly="true"/>

                    <input id="unidades_teoricas_expedidas" label="Unidades teóricas expedidas" value="${view.kg_expedidos gt 0?math:round(view.kg_expedidos*view.unidad_kg)*math:pow(10,2)/math:pow(10,2):null}" readonly="true" />
                </row>
            </table>


        </form>
        <buttonbar type="bottom">
            <button label="Save">
                <action type="save" route="back" registerInHistory="false" restoreView="true">
                    <param name="entityId" value="${params.lote_control_documental_id}" />
                </action>
            </button>

            <button label="Cancel">
                <action type="cancel" route="back" restoreView="true">
                    <param name="entityId" value="${params.lote_control_documental_id}" />
                </action>
            </button>

            <button label="Delete" readonly="${empty (entity.tipo_morcilla_expedicion_id)}" readonlyMessage="No puede realizar esta acción: No existe tipo de morcilla" restoreView="true">
                <action type="delete" route="back" registerInHistory="false" restoreView="true">
                    <param name="entityId" value="${params.lote_control_documental_id}" />
                </action>
            </button>
        </buttonbar>
    </edit>
</main>
