{
  "description": "crtdrd syncronization",
  "tasks": [
    {
      "name": "t1",
      "description": "Starting synchronization",
      "processor": {
        "type": "httpRequestProcessor",
        "method": "post",
        "inputFile": "${gparams.dbFile}",
        "inputFileName": "clientDB.sqlite",
        "url": "${gparams.endpoint}",
        "contentType": "multipart/form-data",
        "headers": {
          "wks": "${gparams.wksId}",
          "user": "${gparams.wksUser}",
          "password": "${gparams.wksPwd}"
        }
      }
    },
    {
      "name": "g1",
      "iterSize": 30,
      "iterDelay": 3000,
      "description": "Checking synchronization state",
      "exitLoopExpression": "${g1.output.contains('FINISHED') || g1.output.contains('ERROR')}",
      "tasks": [
        {
          "name": "t2",
          "processor": {
            "type": "httpRequestProcessor",
            "method": "get",
            "url": "${t1.responseHeaders['Location']}",
            "headers": {
              "wks": "${gparams.wksId}",
              "user": "${gparams.wksUser}",
              "password": "${gparams.wksPwd}"
            },
            "outputContext": "g1"
          }
        }
      ]
    },
    {
      "name": "t3",
      "description": "Downloading file",
      "processor": {
        "type": "httpRequestProcessor",
        "method": "get",
        "url": "${g1.responseHeaders['Location'].replace('synchro','synchroFile'}",
        "outputFileExtension": "zip"
      }
    },
    {
      "name": "t4",
      "processor": {
        "type": "ContextDebugProcessor",
        "output": "console"
      }
    }
  ]
}